# リファクタリング 計画

更新日: 2026-01-25

## プロンプト
まずは重複箇所をユーティリティ化しましょう。
その後、責務分割、状態整理をしましょう。そのときは新規ファイルを作成することも許可します。
その方針で計画を立ててください。

## ステップ
- [x] 重複箇所の棚卸しとユーティリティ化対象の確定
- [x] ユーティリティ実装と既存箇所の置換（座標変換、グリッド/テクスチャ、スプライト整列など）
- [x] 影響範囲の軽微な整理と動作確認
- [x] 責務分割の設計と新規ファイル作成（GameFlow/NPC/Bitなど）
- [x] 状態整理（状態遷移のハンドラ化、定数/型の整理）
- [x] 仕上げ（読みやすさ調整、簡易チェック）

## 結果
座標変換/スプライト整列/テクスチャ作成のユーティリティ化と置換を実施。NPCのナビゲーション処理を分離し、GameFlowのフェード制御をモジュール化。NPC更新の状態処理をハンドラ関数へ整理。
確認: `npm run build:renderer` は既存のトップレベルawait制約で失敗、`npx tsc -p tsconfig.json --noEmit` は既存の型エラーで失敗。
