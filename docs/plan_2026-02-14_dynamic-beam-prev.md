# 接触洗脳演出の品質改善と全滅遷移タイミング修正 計画

更新日: 2026-02-14

## プロンプト
概ねよいですが、問題点を挙げるので修正していってください。
- hit-bからhit-aへ切り替わっていく演出について
  - hit-aに切り替わっていくと同時に、hit-bを消していってください。裏側にhit-bが残っているのはNGです。
  - 切り替わり方がカクカクしています。もっと滑らかに切り替わっていってほしいです。
- 最後の生存者が「触れられて洗脳」されたとき、切り替わり演出の最中に全滅シーン（整列）が始まってしまい、切り替わり途中のスプライトのままになってしまいました。切り替わり演出が完了してから、全滅シーンに移行してください。

## ステップ
- [x] `docs/plan.md` を今回修正タスク用に更新
- [x] 接触洗脳ブレンド合成で、切替領域のhit-b残留を除去
- [x] 接触洗脳の段階数を増やし、切替の滑らかさを改善
- [x] 接触洗脳演出中は全滅シーン遷移を保留する制御を追加
- [x] 型チェック実行と結果確認

## 結果
- 接触洗脳演出の合成処理で、hit-aへ切り替える領域を先にクリアしてから描画するように変更し、切替済み領域にhit-bが裏残りしないようにした。
- 接触洗脳の段階数を `16 -> 32` に増加し、段階選択を `Math.round` から `Math.floor` に変更して、時間軸上の切替をより滑らかにした。
- 全滅シーン遷移判定に「接触洗脳演出中でないこと」を追加し、演出完了前に整列シーンへ移行しないようにした。
- `npx tsc -p tsconfig.json --noEmit` を実行し、成功した。
