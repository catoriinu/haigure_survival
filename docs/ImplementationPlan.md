# Implementation Plan

更新日: 2025-12-27

## 目的
- 仕様書に沿ったMVPをBabylon.js + Vite + Electronで実装し、ブラウザ配布とWindowsアプリ配布の両方を可能にする。

## 対象範囲（MVP）
- タイトル画面、ゲーム画面、リザルト画面
- FPS操作（移動・視点操作）
- 屋内フィールド1種
- プレイヤーとNPC（スプライト・ビルボード）
- 敵ビット（3D）とビーム（円柱）
- 生存時間スコア、全滅時ゲームオーバー

## 非対象
- 屋外フィールド
- 高度なAI/物理エンジン依存挙動
- 3Dキャラクターモデル

## 実装計画
1. 環境構築とプロジェクト骨組み（状態: 完了）
   - Vite + Babylon.js + TypeScriptの初期構成
   - Electron（main/preload/renderer）の構成
   - WebとWindows配布のビルド設定

2. ゲーム基盤（状態: 完了）
   - Babylon.jsシーン初期化、レンダリングループ
   - FPSカメラ、入力処理（WASD + マウス）
   - 屋内フィールド（床/壁/天井）

3. キャラクターと敵（状態: 完了）
   - プレイヤー/ NPCのスプライト + ビルボード
   - NPCの移動ロジック
   - ビットの生成、移動、追尾/ランダム挙動
   - ビットの行動モード（索敵/追尾/固定/ランダム/警戒）
   - ビーム生成/移動/消滅

4. 当たり判定とゲーム進行（状態: 進行中）
   - ビーム×キャラクターのヒット判定
   - NPCの被弾/撃破の状態遷移と命中エフェクト
   - プレイヤーの被弾/撃破の状態遷移と命中エフェクト
   - ビームの壁/床/天井ヒット時の消滅
   - 経過時間の計測と表示、hit/全滅時の記録
   - 状態遷移（生存中/戦闘不能/全滅）
   - 生存時間スコア計測

5. 画面/UIとリトライ導線（状態: 進行中）
   - ゲーム内HUD（ミニマップ/座標/生存数/経過時間/リトライ表示）
   - 画面遷移の状態整理（タイトル/プレイ中/全滅遷移/全滅整列）（完了）
   - タイトル画面（起動直後に表示、"press Enter to start"のみ）（完了）
   - 全滅遷移の条件実装（完了）
     - 自分がdown状態でEnter入力時はフェードアウトして全滅シーンへ
     - 全員downから3秒経過でシームレスに全滅シーンへ
   - 全滅シーン（整列）（完了）
     - ゲームオーバーでビットの新規出現停止
     - キャラクター全員を中央の部屋へ誘導し、所定位置（横5人×2列）に整列
     - ビットを中央の部屋へ集め、キャラクターを中心に円形で周回
     - フェードアウト遷移時は整列済みで表示、シームレス遷移時は移動中も表示
   - Enterでタイトルに戻る導線（完了）
   - down時のHUD表示と全滅シーンのカメラ調整（完了）
   - シームレス遷移時の整列経路を床セル最短経路に変更（完了）
   - 全滅シーンの整列スロットを可変人数対応（完了）

6. 配布・動作確認（状態: 未着手）
   - Webビルド、Electronビルド
   - 動作確認はブラウザを基本とし、Electronは完成直前に確認
