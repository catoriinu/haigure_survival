# ステージJSON導入 計画

更新日: 2026-01-10

## プロンプト
ステージデータ仕様書（docs\spec_stage_json.md）に沿って、外部jsonを元にステージを生成する機能を追加したいです。
現在のコード内で作成しているステージを、json化すると、public\stage\laboratory.jsonのようになります。
laboratory.jsonを読み込んで、現在と同じステージを作れるように、機能追加をしていってください。
まずはコードを調査し、計画を立てて下さい。

## ステップ
- [x] 仕様の不明点を確認し、決定事項（cellSize=既存、height=ceiling.heightCells換算、spawn/noEnemySpawn反映、mainMap寸法を採用、meta.sizeは53へ修正済み）を反映する
- [x] stage jsonの型と読み取り処理を追加し、mainMap/cellPhysicsからGridLayout（cells/rows/columns/height/cellSize）を生成する
- [x] gameplayのmarkers/zonesをspawn/noSpawnCellsへ反映し、stageSelection/buildStageContextで外部jsonの生成経路を組み込む
- [x] 全滅・整列エリアをgameplay.zonesに追加し、ゲームフローが参照するようにする
- [x] laboratory.jsonの生成結果が現行ステージと一致することを確認し、必要な微調整を行う

## 結果
- stage JSONを読み込んでレイアウト/スポーン/全滅整列エリアを生成できるようにした
- laboratory.jsonで開始位置を調整し、従来どおりの開始位置と向きで動作確認済み
