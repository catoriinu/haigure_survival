# ビーム回避FPS（仮）仕様書（最終改訂版）

更新日: 2025-12-27

## 1. ゲーム概要
本作は、3D空間内でプレイヤーおよび複数のNPCが同一フィールドに存在し、
空中を飛行する複数のビットから発射されるビームを回避し続ける
生存時間スコアアタック型FPSゲームである。

キャラクター（プレイヤー・NPC）は一枚絵で表現され、
敵であるビットは3Dオブジェクトとして表現される。
フィールド内の全キャラクターが撃破された時点でゲームオーバーとなる。

## 2. ゲームの最小完成条件（MVP）
以下の条件をすべて満たした時点で、本作は「完成」とみなす。

- プレイヤーが操作可能であること
- タイトル画面が存在すること
- ゲーム中、以下の操作が可能であること
  - 前後移動
  - 左右移動
  - マウスによる視点操作
- 屋内フィールドが1種類以上存在すること
- フィールド内にプレイヤー以外のNPCが存在すること
- プレイヤーおよびNPCが一枚絵キャラクターとして表示されること
- 敵ビットが3Dオブジェクトとして表示されること
- ビームに当たると、プレイヤー・NPCともに戦闘不能になること
- 全キャラクター（プレイヤー＋NPC）が撃破された場合にゲームオーバーとなること
- ゲームオーバー時に全滅シーン（エピローグ）が表示されること
  - 生存時間が表示される
- リトライが容易であること
- 終了条件を満たした後、タイトル画面に戻れること

## 3. 視点・操作仕様
### 視点
- 完全FPS視点
- プレイヤーの体モデルは使用しない
- カメラを基準とした一人称視点

### 操作
- 移動：前後・左右
- 視点操作：マウス
- ジャンプ：なし

### 操作補足（追記）
- FPS視点のため、ゲーム開始時にポインタロックを有効化する
- ポインタロック解除はEscキーで行える

## 4. フィールド仕様
### 共通仕様
- 箱型の閉じた空間を基本とする
- 壁・床・天井を持つ
- フィールド外への移動は不可

### フィールド生成ルール（追記）
- フィールドはセル状のグリッドで管理する
- セルサイズ：12 x 12
- グリッドサイズ：20 x 20 セル
- セルの状態：床 / 壁
- 連結した床セルは「部屋」として扱う
- 1セル幅の床が連続し、両脇が壁の場合は「道」として扱う
- 初期ルール：小大大大小の5部屋が一本道で繋がる
- 両端の小部屋にはNPC/ビットは初期配置されない（移動で侵入は可能）
- プレイヤーの初期位置は左端の小部屋とする

### 屋内フィールド（優先実装）
- 種別：屋内
- 空間イメージ：建物内部・部屋
- 床：
  - 色：紫色
  - 2単位ごとの格子線を入れる
- 壁・天井：
  - 色：灰色
  - 壁は2単位ごとの格子線を入れる
- 視認性を重視し、キャラクターやビームが見やすい配色とする

### 屋外フィールド（将来対応）
- 存在は想定するが、詳細仕様は未定
- 本仕様書では実装対象外とする

## 5. キャラクター共通仕様（プレイヤー・NPC）
### 表現方法
- キャラクターは一枚絵（スプライト）で表現する
- 常にカメラ正面を向くように回転追従する（ビルボード方式）
- キャラクターは縦長の長方形（幅:高さ = 1:1.5）
- 見た目と当たり判定は独立して扱う

### 当たり判定
- 当たり判定形状：円柱型
- 当たり判定は内部処理用であり、可視化しない

## 6. プレイヤーの仕様
### 基本仕様
- FPS操作主体となるキャラクター
- 移動・視点操作が可能
- 初期配置は必ず部屋の内部とする
- 初期の視線方向は、部屋から道に向かう方向とする

### 表示に関する方針
- プレイヤー自身の一枚絵表示については未確定
- 実装する場合はNPCと同等のビルボード方式を採用する

### 被弾ルール
- ビームに1回でもヒットするとhit状態になる
- hit状態は3秒継続し、その間は命中エフェクト（半透明の球体、ピンクと水色を高速に切り替え）を表示する
- hit状態から3秒経過でdown状態になる
- down状態に移行後、1秒かけてピンク色が徐々に透明になっていく
- down後は操作不能となるが、ゲームは継続する
- カメラはその場で待機可能

## 7. NPC（味方キャラクター）の仕様
### 基本仕様
- プレイヤーと同陣営のノンプレイヤーキャラクター
- フィールド内に複数体存在する
- 攻撃能力は持たない
- 初期人数：9体

### 行動
- フィールド内をランダム、またはルールに基づいて走り回る
- ビットの攻撃対象となる

### 表示状態（ステータス別）
NPCの一枚絵は、以下の少なくとも3状態で切り替える。

1. 逃走中
2. 被弾時
3. 撃破後

各状態は別画像として管理する。
指定画像がない場合は仮スプライトを表示する。

### 被弾ルール
- ビームに1回でもヒットするとhit状態になる
- hit状態は3秒継続し、その間は命中エフェクト（半透明の球体、ピンクと水色を高速に切り替え）を表示する
- hit状態から3秒経過でdown状態になる
- down状態に移行後、1秒かけてピンク色が徐々に透明になっていく
- 撃破後は行動不能、復活なし

## 8. 敵（ビット）の仕様
### 基本仕様
- 敵は「ビット」と呼ばれる
- 初期出現数：1体
- 時間経過により出現数が増加する
- 出現間隔：5秒ごと

### 見た目（ビジュアル仕様）
- 3Dオブジェクトとして表現する
- 形状：
  - 基本形状：円錐
  - 錐の頂点部分に、丸い発射口を持つ
- 状態：
  - 常に空中に浮遊している
- 発射口は、ビームの発射方向を視覚的に示す役割を持つ

### 配置・移動
- フィールド内の上空を浮遊
- 前後・左右・上下すべての方向に移動可能
- 壁や天井を越えない範囲で上下移動する
- プレイヤー/NPCの真上（水平半径3メートル以内）には侵入しない
- 移動速度（目安）：索敵3.0、追尾1.8、その他2.4

### 行動・ターゲット
- 攻撃対象：
  - プレイヤー
  - NPC
- 戦闘不能になったキャラクターは対象外とする
- 索敵範囲：距離48メートル（約4セル）、視野角は前方約144度（上下含む）
- 一部のビットは以下の挙動を持つ
  - 対象を発見すると追尾する
- その他のビットは以下の挙動も持ち得る
  - ランダム方向にビームを発射する

### 行動モード
ビットは以下のモードを持ち、条件に応じて遷移する。
- 索敵モード
  - ビーム：発射しない
  - ランダムに移動する
  - キャラクターを視界に捉えたら、いずれかの攻撃モードまたは警戒モードに移行する
- 攻撃モード（追尾）
  - ビーム：キャラクターの近くに来たら、キャラクター向きに発射する（発射頻度は低い）
  - 発射間隔（目安）：2.0〜2.8秒
  - 最も近いキャラクターを追尾して移動する
  - キャラクターが一定距離（固定モードより範囲が狭い）より離れたら索敵モードに移行する
  - 10秒経過で索敵モードに移行する
- 攻撃モード（固定）
  - ビーム：攻撃モードに移行した時点のキャラクター方向に発射する（発射頻度は多い）
  - 発射間隔（目安）：1.0〜1.6秒
  - 移動せず固定砲台になる（水平方向は固定、上下方向のみ調整）
  - キャラクターが一定距離（追尾モードより範囲が広い）より離れたら索敵モードに移行する
  - 10秒経過で索敵モードに移行する
- 攻撃モード（ランダム）
  - ビーム：現在のビットの向きに発射する（発射頻度は高い）
  - 発射間隔（目安）：0.4〜0.8秒
  - ランダムに移動したり向きを変えながら攻撃する
  - 一定時間経過（例：10秒）で索敵モードに移行する
- 警戒モード
  - ビーム：発射しない
  - 敵を発見したことを周囲のビットに報告し、近くのビットが集まる
  - 一定時間経過で索敵モードに移行する
- 自身のビームが命中したキャラクターがhitの間は停止し、ビームを発射しない
- 命中したキャラクターがdownになったら索敵モードに戻る
- 索敵時のモード遷移確率：追尾45%、固定25%、ランダム15%、警戒15%
- 将来的なモード追加や遷移条件の拡張を前提とする

## 9. 攻撃（ビーム）の仕様
- 攻撃手段：円柱型ビーム
- 発射元：ビットの発射口
- 発射方向：基本は直線
- 発射口（円錐頂点）の向きに合わせて発射する
- 太さ：細め
- 速度：避けにくいが回避可能な速さ
- 同時存在数：多め
- 寿命：
  - フィールド外に出たら消滅
  - 壁・床・天井に命中したら消滅
  - キャラクターに命中したら消滅

## 10. 当たり判定ルール
- 判定対象：
  - ビーム × プレイヤー
  - ビーム × NPC
- ビームが対象キャラクターに接触した場合、ヒットと判定
- ヒット時の結果：
  - hit状態に移行し、その後のdown遷移は各キャラクター仕様に従う

## 11. ゲーム進行・終了ルール
### 状態定義
- 生存中：プレイヤー操作可能
- プレイヤー戦闘不能
  - 操作不能
  - 観戦・待機状態
  - NPCとゲーム進行は継続
  - Enter入力で全滅シーン（エピローグ）へ移行できる
- 全滅
  - プレイヤーおよび全NPCが戦闘不能
  - ゲームオーバー
  - 全員downから3秒経過で全滅シーン（エピローグ）へ移行する

### スコア
- スコア形式：生存時間
- 計測終了タイミング：全滅時
- プレイヤーがhitした時点の経過時間を保存する
- 全滅時の経過時間を保存する

## 12. 難易度変化の方針
- 時間経過により難易度上昇
- 主な変化要素：
  - ビット出現数の増加
  - ビーム発射頻度の増加

## 13. 演出・表現方針
- エフェクトは比較的派手にしてよい
- ビットの発射口・ビーム発射方向が視覚的に分かることを重視する

## 14. 今回やらないこと（非対象）
- プレイヤー・NPCの3Dモデル実装
- 敵の高度なAIロジック
- 物理エンジン依存の複雑な挙動
- 屋外フィールドの実装
- ストーリー要素

## 15. 開発方針メモ
- 一枚絵（キャラ）＋3D（敵）の混在前提で設計する
- 見た目と当たり判定を明確に分離する
- 屋内フィールドを基準にゲームバランスを調整する
- 将来、屋外フィールド追加を想定した拡張可能な構成とする

## 16. 画面構成・遷移（追記）
- タイトル画面（press Enter to start） → ゲーム画面 → 全滅シーン（エピローグ） → タイトル画面
- プレイヤーdown時にEnterで全滅シーンへ、全滅シーンでEnterでタイトルに戻る

## 17. プラットフォーム・配布（追記）
- ブラウザ配布：Viteビルド成果物
- Windows配布：Electronビルド成果物

## 18. ミニマップ（追記）
- 画面左上に常時表示する
- 現在地を中心に表示する
- フィールドを上から見たときに、床/壁が色で判別できる
- プレイヤーの向きに合わせてミニマップ全体が回転する
- 将来的にボタンでオン/オフ切り替え可能にする
- 現在座標をミニマップ付近に表示する
- プレイヤーの視界方向を扇形で表示する（扇形は常に上向き）
- 生存中のキャラクター数（PC + NPC）を表示する
- 経過時間をリアルタイム表示する
- プレイヤーがdown状態のとき、生存時間と「press Enter to epilogue」を表示する
- 全滅シーンではHUDを非表示とし、「press Enter to title」を表示する
